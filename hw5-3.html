<html>
<head>
<style>
#info {
  position: absolute;
  top: 2%;
  width: 100%;
  padding: 10px;
  text-align: center;
  color: #ffff00
}

body {
  overflow: hidden;
}
</style>
</head>

<body> 
<div id="info">
  hw5-3 Basic GLSL <br>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/109/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://raw.githack.com/mrdoob/three.js/dev/examples/js/geometries/TeapotBufferGeometry.js"></script>

<script id="myVertexShader" type="x-shader/x-vertex">
    uniform vec3 lightpos;  // world coordinate
    varying vec3 eyelightdir;
    varying vec3 eyenormal;
    
    varying vec4 eyepos;
    
    void main() {
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);

        eyepos = modelViewMatrix * vec4 (position, 1.0);
        vec4 eyelightpos= viewMatrix * vec4 (lightpos, 1.0);
        eyelightdir = normalize (eyelightpos.xyz - eyepos.xyz);
        eyenormal = normalMatrix * normal;
    }
</script>
<script id="myFragmentShader" type="x-shader/x-fragment">
    varying vec3 eyelightdir;
    varying vec3 eyenormal;
    varying vec4 eyepos;
    uniform float opacity;
    
    void main() {
        float intensity = dot (normalize (eyenormal), normalize (eyelightdir));    
        vec3 diffuse = intensity*vec3 (1,1,1);
    
        vec3 h = normalize(-normalize (eyepos.xyz) + normalize (eyelightdir));
        float shininess = 40.;    
        vec3 specular = pow (dot (eyenormal, h), shininess) *vec3 (1,0,0);
        gl_FragColor = vec4(diffuse + specular, opacity);
    }
</script>

<script>
$('#shading').change( function() {
	console.log ( $(this).val() );
	let method = $(this).val();
	if (method === 'perVertex') {
		teapotMaterial.uniforms.shading.value = 0;
	} else if (method === 'perPixel') {
		teapotMaterial.uniforms.shading.value = 1;
	}
});
var scene, renderer, camera;
var movingTeapot, stableTeapot;
var angle = 0;
var teapotMaterial;
init();
animate();
function init() {
  var width = window.innerWidth;
  var height = window.innerHeight;

  renderer = new THREE.WebGLRenderer({
    antialias: true
  });
  renderer.setSize(width, height);
  renderer.setClearColor(0x888888);
  document.body.appendChild(renderer.domElement);

  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 10000);
  camera.position.z = 200;
  camera.lookAt(new THREE.Vector3(0, 0, 0));

  controls = new THREE.OrbitControls(camera, renderer.domElement);

  var gridXZ = new THREE.GridHelper(200, 20, 'red', 'white');
  scene.add(gridXZ);

  pointLight = new THREE.PointLight(0xffffff);
  pointLight.position.set(200, 300, 200);
  scene.add(pointLight);
  var ambientLight = new THREE.AmbientLight(0x111111);
  scene.add(ambientLight);
  /////////////////////////////////////////////////////////////////

    meshMaterial = new THREE.ShaderMaterial({
        uniforms: {
        lightpos: {type: 'v3', value: new THREE.Vector3()},
        opacity: {type: 'f', value: 1.0}
        },
        vertexShader: document.getElementById('myVertexShader').textContent,
        fragmentShader: document.getElementById('myFragmentShader').textContent
    });
	  meshMaterial.transparent = true;
	  
	  movingTeapot = new THREE.Mesh (new THREE.TeapotBufferGeometry(10), meshMaterial);
	  movingTeapot.position.set(10,10,15);
	  scene.add (movingTeapot);
   //meshMaterial.transparent = true;
  
  /*var geometry = new THREE.TorusKnotGeometry(20, 5, 100, 16);
    mesh = new THREE.Mesh(geometry, meshMaterial);
    scene.add(mesh);*/
  
    //base
	var geometry = new THREE.PlaneGeometry( 200, 200, 100 );
	var material = new THREE.MeshLambertMaterial( {color: 0xb9bac7, side: THREE.DoubleSide} );
	var base = new THREE.Mesh( geometry, material );
	base.rotation.x = -Math.PI/2;
	scene.add( base );
	
	
	//box
	var geometry = new THREE.BoxGeometry( 80, 10, 30 );
	var material = new THREE.MeshLambertMaterial( {color: 0xb9bac7} );
	var cube = new THREE.Mesh( geometry, material );
	cube.position.set(-60,5,-85);
	scene.add( cube );
	
	var geometry = new THREE.BoxGeometry( 50, 10, 200 );
	var material = new THREE.MeshLambertMaterial( {color: 0xb9bac7} );
	var cube = new THREE.Mesh( geometry, material );
	cube.position.set(75,5,0);
	scene.add( cube );

  
}
function animate() {
  //angle += 0.01;
  // update the uniform variable
  
 /* if (movingTeapot !== undefined) {
	movingTeapot.position.set (45*Math.cos(angle), 0, 45*Math.sin(angle));
  }*/
     angle += 0.01;
    pointLight.position.set(50 * Math.cos(angle), 80, 50 * Math.sin(angle));
    
    meshMaterial.uniforms.lightpos.value.copy (pointLight.position);
	 meshMaterial.uniforms.opacity.value = Math.abs(Math.sin (angle));    
  
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}

</script>
</body>

</html>
  